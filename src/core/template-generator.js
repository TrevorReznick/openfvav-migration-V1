import { join, dirname } from 'path';
import { existsSync, mkdirSync, writeFileSync } from 'fs';
import chalk from 'chalk';

export async function createTokenTemplates(destPath) {
  const tokensDir = join(destPath, 'src/lib');
  const stylesDir = join(destPath, 'src/styles');
  
  // Crea directory se non esistono
  mkdirSync(tokensDir, { recursive: true });
  mkdirSync(stylesDir, { recursive: true });
  
  const tokensFile = join(tokensDir, 'tokens.ts');
  const globalsFile = join(stylesDir, 'globals.css');
  
  // Controlla se i file esistono gi√† (non sovrascrivere)
  if (existsSync(tokensFile) && existsSync(globalsFile)) {
    console.log(chalk.gray('   Templates already exist, skipping...'));
    return;
  }
  
  // Template per tokens.ts
  const tokensContent = `// Auto-generated by OpenFav Migration
// Run 'npm run hydrate' to inject actual values

export const tokens = {
  colors: {
    // @inject:--primary
    primary: '262 83% 58%',
    // @inject:--background
    background: '222 47% 11%',
    // @inject:--foreground
    foreground: '210 40% 98%',
    // @inject:--card
    card: '222 47% 11%',
    // @inject:--card-foreground
    'card-foreground': '210 40% 98%',
    // @inject:--border
    border: '217 33% 17%',
    // @inject:--input
    input: '217 33% 17%',
    // @inject:--secondary
    secondary: '217 33% 17%',
    // @inject:--secondary-foreground
    'secondary-foreground': '210 40% 98%',
    // @inject:--accent
    accent: '217 33% 17%',
    // @inject:--accent-foreground
    'accent-foreground': '210 40% 98%',
    // @inject:--destructive
    destructive: '0 63% 31%',
    // @inject:--destructive-foreground
    'destructive-foreground': '210 40% 98%',
    // @inject:--ring
    ring: '217 33% 17%',
  },
  spacing: {
    // @inject:--0
    0: '0',
    // @inject:--1
    1: '0.25rem',
    // @inject:--2
    2: '0.5rem',
    // @inject:--3
    3: '0.75rem',
    // @inject:--4
    4: '1rem',
    // @inject:--5
    5: '1.25rem',
    // @inject:--6
    6: '1.5rem',
    // @inject:--8
    8: '2rem',
    // @inject:--10
    10: '2.5rem',
    // @inject:--12
    12: '3rem',
  },
  typography: {
    // @inject:--font-family
    'font-family': 'Inter, sans-serif',
    // @inject:--font-size-xs
    'font-size-xs': '0.75rem',
    // @inject:--font-size-sm
    'font-size-sm': '0.875rem',
    // @inject:--font-size-base
    'font-size-base': '1rem',
    // @inject:--font-size-lg
    'font-size-lg': '1.125rem',
    // @inject:--font-size-xl
    'font-size-xl': '1.25rem',
    // @inject:--font-size-2xl
    'font-size-2xl': '1.5rem',
  }
} as const;

export type Tokens = typeof tokens;
export default tokens;
`;

  // Template per globals.css
  const globalsContent = `/* Auto-generated by OpenFav Migration */
/* Run 'npm run hydrate' to inject actual values */

@layer base {
  :root {
    /* @inject:--primary */
    --primary: 262 83% 58%;
    /* @inject:--background */
    --background: 222 47% 11%;
    /* @inject:--foreground */
    --foreground: 210 40% 98%;
    /* @inject:--card */
    --card: 222 47% 11%;
    /* @inject:--card-foreground */
    --card-foreground: 210 40% 98%;
    /* @inject:--border */
    --border: 217 33% 17%;
    /* @inject:--input */
    --input: 217 33% 17%;
    /* @inject:--secondary */
    --secondary: 217 33% 17%;
    /* @inject:--secondary-foreground */
    --secondary-foreground: 210 40% 98%;
    /* @inject:--accent */
    --accent: 217 33% 17%;
    /* @inject:--accent-foreground */
    --accent-foreground: 210 40% 98%;
    /* @inject:--destructive */
    --destructive: 0 63% 31%;
    /* @inject:--destructive-foreground */
    --destructive-foreground: 210 40% 98%;
    /* @inject:--ring */
    --ring: 217 33% 17%;

    /* Spacing */
    /* @inject:--spacing-0 */
    --spacing-0: 0;
    /* @inject:--spacing-1 */
    --spacing-1: 0.25rem;
    /* @inject:--spacing-2 */
    --spacing-2: 0.5rem;
    /* @inject:--spacing-3 */
    --spacing-3: 0.75rem;
    /* @inject:--spacing-4 */
    --spacing-4: 1rem;
    /* @inject:--spacing-5 */
    --spacing-5: 1.25rem;
    /* @inject:--spacing-6 */
    --spacing-6: 1.5rem;
    /* @inject:--spacing-8 */
    --spacing-8: 2rem;
    /* @inject:--spacing-10 */
    --spacing-10: 2.5rem;
    /* @inject:--spacing-12 */
    --spacing-12: 3rem;

    /* Typography */
    /* @inject:--font-family */
    --font-family: Inter, sans-serif;
    /* @inject:--font-size-xs */
    --font-size-xs: 0.75rem;
    /* @inject:--font-size-sm */
    --font-size-sm: 0.875rem;
    /* @inject:--font-size-base */
    --font-size-base: 1rem;
    /* @inject:--font-size-lg */
    --font-size-lg: 1.125rem;
    /* @inject:--font-size-xl */
    --font-size-xl: 1.25rem;
    /* @inject:--font-size-2xl */
    --font-size-2xl: 1.5rem;
  }
}
`;

  // Scrivi i file solo se non esistono
  if (!existsSync(tokensFile)) {
    writeFileSync(tokensFile, tokensContent);
    console.log(chalk.gray(`   Created: ${tokensFile}`));
  }
  
  if (!existsSync(globalsFile)) {
    writeFileSync(globalsFile, globalsContent);
    console.log(chalk.gray(`   Created: ${globalsFile}`));
  }
}
