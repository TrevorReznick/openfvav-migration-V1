# ANALISI DELLA TUA CONFIGURAZIONE
```typescript
// tailwind.config.ts - Struttura ATTESO dalla tua pipeline
import { tokens } from "./src/lib/tokens"; // ‚¨ÖÔ∏è Importa da tokens.ts

const config: Config = {
  theme: {
    extend: {
      // 1. Spacing dai token
      spacing: tokens.spacing, // ‚¨ÖÔ∏è ATTENZIONE: struttura diversa!
      
      // 2. Colors con due approcci:
      colors: {
        // A) Tutti i colori flat
        ...Object.fromEntries(...), // Colori piatti
        
        // B) Gruppi shadcn (primary, secondary, destructive)
        primary: {
          DEFAULT: "hsl(var(--primary))",
          foreground: "hsl(var(--foreground))",
          hover: "hsl(var(--primary-hover))",
        },
      }
    }
  }
};
```

## üîß MODIFICHE NECESSARIE ALLA PIPELINE

### 1. tokens.ts deve avere una struttura SPECIFICA
```typescript
// src/lib/tokens.ts - COME LO VUOLE LA TUA CONFIG
export const tokens = {
  // Spacing come RECORD<string, string>
  spacing: {
    '0': '0px',
    '1': '0.25rem',
    '2': '0.5rem',
    // ... i tuoi token V4
  },
  
  // Colors come RECORD<string, string>
  colors: {
    'primary': '#3B82F6',
    'primary-hover': '#2563EB', // ‚¨ÖÔ∏è Nota: con trattino!
    'foreground': '#0F172A',
    'background': '#FFFFFF',
    // ...
  },
  
  // Typography
  typography: {
    sans: 'Inter, system-ui, sans-serif',
    mono: 'JetBrains Mono, monospace',
  }
} as const;
```

### 2. La pipeline deve GENERARE tokens.ts in questo formato
```javascript
// pipeline/token-generator.js
class TokenGenerator {
  generateTokensTS(v4Tokens, v6Path) {
    const content = `// AUTO-GENERATED BY OPENFAV PIPELINE
export const tokens = {
  // === SPACING ===
  spacing: {
    ${this.generateSpacingEntries(v4Tokens.spacing)}
  },
  
  // === COLORS ===
  colors: {
    ${this.generateColorEntries(v4Tokens.colors)}
  },
  
  // === TYPOGRAPHY ===  
  typography: {
    sans: ${JSON.stringify(v4Tokens.typography?.sans || 'system-ui, sans-serif')},
    mono: ${JSON.stringify(v4Tokens.typography?.mono || 'monospace')},
  }
} as const;

// Helper functions
export const getColor = (key: keyof typeof tokens.colors) => 
  \`hsl(var(--\${key.replace(/-/g, '')}))\`;

export const getSpacing = (key: keyof typeof tokens.spacing) => 
  tokens.spacing[key];

export type ColorKey = keyof typeof tokens.colors;
export type SpacingKey = keyof typeof tokens.spacing;`;
    
    writeFileSync(`${v6Path}/src/lib/tokens.ts`, content);
  }
  
  generateColorEntries(colors) {
    // Converte 'primaryHover' ‚Üí 'primary-hover' per compatibilit√†
    return Object.entries(colors)
      .map(([key, value]) => {
        const normalizedKey = this.normalizeColorKey(key);
        return `// @inject:${normalizedKey}\n    '${normalizedKey}': '${value}',`;
      })
      .join('\n    ');
  }
  
  normalizeColorKey(key) {
    // Converte camelCase a kebab-case
    return key.replace(/([A-Z])/g, '-$1').toLowerCase();
  }
}
```

### 3. La pipeline deve AGGIORNARE tailwind.config.ts
```javascript
// pipeline/tailwind-updater.js
class TailwindUpdater {
  updateConfig(v6Path, v4Tokens) {
    const configPath = `${v6Path}/tailwind.config.ts`;
    let content = readFileSync(configPath, 'utf-8');
    
    // 1. Verifica che importi tokens
    if (!content.includes('from "./src/lib/tokens"')) {
      content = content.replace(
        'import type { Config } from "tailwindcss";',
        'import type { Config } from "tailwindcss";\nimport { tokens } from "./src/lib/tokens";'
      );
    }
    
    // 2. Aggiorna la parte colors se non c'√® gi√†
    if (!content.includes('...Object.fromEntries(')) {
      // Aggiungi il mapping dei colori
      const colorsMapping = this.generateColorsMapping(v4Tokens.colors);
      content = this.injectColorsMapping(content, colorsMapping);
    }
    
    writeFileSync(configPath, content);
  }
  
  generateColorsMapping(colors) {
    const entries = Object.keys(colors)
      .map(key => `['${key.replace(/-/g, '')}', \`hsl(var(--${key}))\`]`);
    
    return `...Object.fromEntries([\n${entries.join(',\n')}\n]),`;
  }
}
```

## üöÄ IMPLEMENTAZIONE STEP-BY-STEP

### Step 1: Aggiorna il tuo css-extractor.js per estrarre in questo formato
```javascript
// css-extractor.js - AGGIUNGI:
function normalizeForV6Config(rawTokens) {
  return {
    spacing: rawTokens.spacing, // Gi√† nel formato giusto
    
    colors: Object.fromEntries(
      Object.entries(rawTokens.colors).map(([key, value]) => [
        // Converte 'primaryHover' ‚Üí 'primary-hover'
        key.replace(/([A-Z])/g, '-$1').toLowerCase(),
        value
      ])
    ),
    
    typography: {
      sans: rawTokens.typography?.['font-family'] || 'system-ui, sans-serif',
      mono: rawTokens.typography?.['font-mono'] || 'monospace',
    }
  };
}
```

### Step 2: Modifica il command migrate
```javascript
// src/cli.js
program
  .command('migrate')
  .description('üöÄ Migra token V4 ‚Üí V6 (config avanzata)')
  .action(async () => {
    console.log(chalk.blue('\nüéØ OpenFav Migration v2.1'));
    console.log(chalk.gray('Configurazione avanzata con shadcn/ui\n'));
    
    // 1. Estrai e normalizza
    const v4Tokens = await extractTokensFromCss(config.v4Path);
    const normalized = normalizeForV6Config(v4Tokens);
    
    // 2. Genera tokens.ts
    await generateTokensTS(normalized, config.v6Path);
    
    // 3. Aggiorna tailwind.config.ts
    await updateTailwindConfig(normalized, config.v6Path);
    
    // 4. Crea globals.css
    await generateGlobalsCSS(normalized, config.v6Path);
    
    console.log(chalk.green('\n‚úÖ Configurazione V6 aggiornata!'));
    console.log(chalk.gray('   Classi disponibili:'));
    console.log(chalk.gray('   - bg-primary, text-foreground'));
    console.log(chalk.gray('   - p-4, m-6 (dai token spacing)'));
    console.log(chalk.gray('   - font-sans, font-mono'));
  });
```

## ‚úÖ RISULTATO FINALE

Dopo la migrazione, il tuo V6 avr√†:

1. **tokens.ts** - Strutturato per la tua config
2. **tailwind.config.ts** - Aggiornato con mapping corretto
3. **globals.css** - Con tutte le CSS variables
4. **Classi Tailwind funzionanti:**
```html
<!-- Tutto funziona! -->
<div class="bg-primary text-foreground p-4 font-sans">
  <button class="bg-primary-hover">Hover me</button>
</div>
```

## ‚ö†Ô∏è NOTA IMPORTANTE

La tua config usa **due approcci** per i colori:

1. **Flat colors** (`...Object.fromEntries`) - Per accesso diretto
2. **Nested groups** (`primary: { DEFAULT, foreground }`) - Per shadcn/ui

La pipeline deve supportare **entrambi**! Dobbiamo assicurarci che le CSS variables siano definite per tutti.